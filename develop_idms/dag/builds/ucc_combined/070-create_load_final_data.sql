DROP TABLE IF EXISTS {tablename4} ; 

CREATE TABLE {tablename4}
(
ID bigint encode az64,
MMDBKey varchar (50)  encode zstd,
IUSAKey varchar (19) encode zstd,
DT_ABINumber varchar(150) encode zstd, 
DT_FirstName varchar(150)  encode zstd, 
DT_MiddleName varchar(150) encode zstd, 
DT_LastName varchar(150) encode zstd, 
DT_NameSuffix varchar(150) encode zstd, 
DT_Address varchar(150) encode zstd, 
DT_City varchar(150)  encode zstd, 
DT_State varchar(50)  encode zstd,
DT_ZipCode varchar(15) encode zstd,
DT_Zip4 varchar(15) encode zstd,
DT_CarrierRouteCode varchar(150) encode bytedict, 
DT_Company varchar(150) encode zstd,
DT_CorporateIndividual char(150) encode zstd, 
DT_DateAdded varchar(8) encode zstd,
DT_DateAdded_Day varchar(32) encode zstd, 
DT_DateAdded_Month varchar(15) encode zstd, 
DT_DateAdded_Year varchar(30) encode zstd,
DT_DateLastReceived varchar(8) encode zstd,
DT_DateLastReceived_Day varchar(30) encode zstd, 
DT_DateLastReceived_Month varchar(15) encode zstd, 
DT_DateLastReceived_Year varchar(30) encode zstd,
DT_DeliverabilityScore varchar(50) encode zstd, 
DT_DeliveryPointBarCode varchar(30) encode zstd,
DT_ExpirationDate varchar(8) encode zstd, 
DT_ExpirationDate_Day varchar(8) encode zstd, 
DT_ExpirationDate_Month varchar(150) encode zstd,  
DT_ExpirationDate_Year varchar(30) encode zstd,
DT_Filing_Date varchar(8) encode zstd,
DT_Filing_Day varchar(8) encode zstd, 
DT_Filing_Month varchar(150) encode zstd, 
DT_Filing_Year varchar(50) encode zstd, 
DT_FilingState varchar(50) encode zstd, 
DT_FilingStatus char(150) encode zstd,
DT_FilingTypeCode varchar(150) encode zstd,  
DT_OriginalFilingID varchar(150) encode zstd, 
DT_PartyType char(150) encode zstd, 
DT_SourceFilingID varchar(150) encode zstd,
---new fields for UCC combined
DT_USPSRecordType varchar (150) encode zstd, 
DT_MatchType char(150) encode zstd, 
DT_MatchScore varchar (150) encode zstd,
DT_CollateralType_Comb varchar(150) encode zstd,
DT_CollateralType_Multi varchar(150) encode zstd,
DT_CollateralType varchar(30) encode zstd, 
DT_CollateralType2 varchar (30) encode zstd,
DT_CollateralType3 varchar (30) encode zstd,
DT_CollateralType4 varchar (30) encode zstd,
DT_CollateralType5 varchar (30) encode zstd,
DT_CollateralType6 varchar (30) encode zstd,
DT_CollateralType7 varchar (30) encode zstd,
DT_CollateralType8 varchar (30) encode zstd,
DT_CollateralType9 varchar (30) encode zstd,
DT_CollateralType10 varchar (30) encode zstd,
DT_StateCode VARCHAR (150)  encode zstd,
DT_CountyCode VARCHAR(150) encode bytedict,
DT_CountyCode_Description VARCHAR(40) encode zstd,

---Securred party fields
SP_ABINumber  varchar (90) encode zstd,
SP_LocationName varchar(150) encode zstd, 
SP_Address varchar(150) encode zstd, 
SP_City varchar(30) encode zstd, 
SP_State varchar(30) encode zstd,  
SP_Zip varchar(50) encode zstd, 
SP_ZIP4 varchar(50) encode zstd, 

---IG Exec fields
IGE_FullName varchar(32) encode zstd,
IGE_TitleCode  varchar(30) encode zstd,
IGE_TitleCode_Back Varchar(30) encode zstd,
IGE_VendorEthnicity varchar (30) encode zstd, 
IGE_ContactID varchar (50) encode zstd,

---IG fields
IG_Company varchar (150) encode zstd,
IG_Mailing_Address varchar(150) encode zstd, 
IG_Mailing_City varchar(16) encode zstd, 
IG_Mailing_State varchar(150) encode zstd, 
IG_Mailing_StateCode varchar(150) encode zstd,  
IG_Mailing_Zip varchar(150) encode zstd,
IG_Mailing_ZipFour varchar(150) encode zstd,
IG_Mailing_CarrierRouteCode varchar(150) encode zstd, 
IG_Location_Address varchar(150) encode zstd, 
IG_Location_City varchar(16) encode zstd, 
IG_Location_State varchar(150) encode zstd, 
IG_Location_Zip varchar(150) encode zstd,
IG_Location_ZipFour varchar(150) encode zstd, 
IG_Location_CarrierRouteCode varchar(150) encode zstd,
IG_CountyCode varchar(150) encode zstd,
IG_CensusTract varchar(150) encode zstd, 
IG_CensusBlock char(150) encode zstd,
fLATITUDE varchar(18) encode zstd,
fLONGITUDE varchar(18) encode zstd,
IG_MatchCode char(150) encode zstd,
IG_PhoneNumber varchar(50) encode zstd, 
IG_FaxPhone varchar(50) encode zstd, 
IG_PrimarySIC6 varchar(150) encode zstd, 
IG_SICCode1 varchar(150) encode zstd, 
IG_SICCode2 varchar(150) encode zstd, 
IG_SICCode3 varchar(150) encode zstd, 
IG_SICCode4 varchar(150) encode zstd, 
IG_NAICSCode varchar(8) encode zstd, 
IG_EmployeeSizeCode2 char(150) encode zstd,
IG_NumberEmployees varchar(150) encode bytedict,
IG_OutputVolumeCode2 char(150) encode zstd,
IG_OutputVolume2 varchar(8) encode zstd,
IG_SubsidairyABINumber varchar(150) encode zstd, 
IG_ParentABINumber varchar(150) encode zstd, 
IG_BusinessStatusCode char(150) encode zstd,
IG_YearFirstAppeared varchar(150) encode zstd,
IG_CreditAlphaScore varchar(50) encode zstd, 
IG_CreditNumericScore varchar(150) encode zstd,
IG_CottageCode char(150) encode zstd,
IG_OwnOrLease char(150) encode zstd,
IG_Squarefootage8 char(150) encode zstd,
IG_WebAddress varchar(150) encode zstd, 
IG_CallStatusCode char(150) encode zstd,
Fulfillment_Flag varchar(150) encode zstd,
IG_PhoneNumberType varchar(150) encode zstd,

---new fields for UCC combined
IG_CBSACode varchar (150) encode zstd,
IG_CBSALevel varchar (150) encode zstd,
IG_CSACode varchar (150) encode zstd,
IG_LegalName varchar (120) encode zstd,
IG_Mailing_SCF varchar(150) encode zstd, 
IG_Mailing_StateCountyName varchar(60) encode zstd,
IG_Mailing_StateCity varchar(150) encode zstd,
IG_Mailing_StateCityZip varchar(150) encode zstd,
IG_Mailing_StateCountyCode varchar(150) encode zstd,
IG_Mailing_StateCitySCF varchar(150) encode zstd,

---system and Calculated fields
FirstName  varchar(50) encode zstd, 
LastName  varchar(50) encode zstd, 
Gender char(50) encode zstd,
AddressLine1  varchar(150) encode zstd, 
City  varchar(150)  encode zstd, 
State  varchar(150)  encode zstd, 
Zip  varchar(150)   encode zstd,
DT_Filing_YYYYMM varchar(150) encode zstd,
DT_statecountycode varchar(150) encode zstd,
DT_FullName varchar(150) encode zstd, 
MATCHCODE_LRFS  varchar(39) encode zstd, 
Has_IG_Mailing_Address char(150) encode zstd, 
Has_IGE_ContactName  char(150) encode zstd,
Has_IG_WebAddress  char(150) encode zstd,
Has_IG_PhoneNumber varchar(150) encode zstd,
Has_DT_FullName char(150) encode zstd,
ListID varchar(150) encode zstd,
BusinessEmailFlag  Char(50)  encode zstd,
ListType char(150) encode zstd,
PermissionType char(150)  encode zstd,
ProductCode char(150) encode zstd,
DT_AddressZip varchar(45) encode zstd,
TitleCode VARCHAR(150) encode zstd,
---dd tables columns
DT_CorporateIndividual_Description VARCHAR(150) encode zstd,
DT_DeliverabilityScore_Description VARCHAR(150) encode zstd,
DT_FilingState_Description VARCHAR(150) encode zstd,
DT_FilingStatus_Description VARCHAR(150) encode zstd,
DT_FilingTypeCode_Description VARCHAR(150) encode zstd,
DT_USPSRecordType_Description VARCHAR(150) encode zstd,
DT_MatchType_Description VARCHAR(150) encode zstd,
DT_CollateralType_Description VARCHAR(150) encode zstd,
IGE_TitleCode_Description VARCHAR(150) encode zstd,
IGE_VendorEthnicity_Description VARCHAR(150) encode zstd,
IG_Mailing_State_Description VARCHAR(150) encode zstd,
IG_MatchCode_Description VARCHAR(150) encode zstd,
IG_EmployeeSizeCode2_Description VARCHAR(150) encode zstd,
IG_OutputVolumeCode2_Description VARCHAR(150) encode zstd,
IG_BusinessStatusCode_Description VARCHAR(150) encode zstd,
IG_CreditAlphaScore_Description VARCHAR(150) encode zstd,
IG_CottageCode_Description VARCHAR(150) encode zstd,
IG_OwnOrLease_Description VARCHAR(150) encode zstd,
IG_Squarefootage8_Description VARCHAR(150) encode zstd,
IG_CallStatusCode_Description VARCHAR(150) encode zstd,
Fulfillment_Flag_Description VARCHAR(150) encode zstd,
IG_CBSALevel_Description VARCHAR(150) encode zstd,
State_Description VARCHAR(150) encode zstd,
IG_PrimarySIC6_Description VARCHAR(150) encode zstd,
IG_SICCode1_Description VARCHAR(150) encode zstd,
IG_SICCode2_Description VARCHAR(150) encode zstd,
IG_SICCode3_Description VARCHAR(150) encode zstd,
IG_SICCode4_Description VARCHAR(150) encode zstd,
IG_NAICSCode_Description VARCHAR(150) encode zstd,
IG_CountyCode_Description VARCHAR(150) encode zstd)
DISTKEY(id)
SORTKEY(id)
;




insert into {tablename4} 
select
A.ID,
A.MMDBKey ,
A.IUSAKey ,
A.DT_ABINumber ,
A.DT_FirstName ,
A.DT_MiddleName ,
A.DT_LastName ,
A.DT_NameSuffix ,
A.DT_Address ,
A.DT_City ,
A.DT_State ,
A.DT_ZipCode ,
A.DT_Zip4 ,
A.DT_CarrierRouteCode ,
A.DT_Company ,
A.DT_CorporateIndividual,
A.DT_DateAdded ,
A.DT_DateAdded_Day ,
A.DT_DateAdded_Month ,
A.DT_DateAdded_Year ,
A.DT_DateLastReceived ,
A.DT_DateLastReceived_Day ,
A.DT_DateLastReceived_Month ,
A.DT_DateLastReceived_Year ,
A.DT_DeliverabilityScore ,
A.DT_DeliveryPointBarCode ,
A.DT_ExpirationDate ,
A.DT_ExpirationDate_Day ,
A.DT_ExpirationDate_Month ,
A.DT_ExpirationDate_Year ,
A.DT_Filing_Date ,
A.DT_Filing_Day ,
A.DT_Filing_Month ,
A.DT_Filing_Year ,
A.DT_FilingState ,
A.DT_FilingStatus,
A.DT_FilingTypeCode ,
A.DT_OriginalFilingID ,
A.DT_PartyType,
A.DT_SourceFilingID ,
A.DT_USPSRecordType ,
A.DT_MatchType,
A.DT_MatchScore ,
case when LTRIM(RTRIM(A.DT_CollateralType_Comb))='' then ''  else A.DT_CollateralType_Comb end as DT_CollateralType_Comb,
case when LTRIM(RTRIM(A.DT_CollateralType_Comb))='' then ''  else A.DT_CollateralType_Multi end as DT_CollateralType_Multi,
A.DT_CollateralType ,
A.DT_CollateralType2 ,
A.DT_CollateralType3 ,
A.DT_CollateralType4 ,
A.DT_CollateralType5 ,
A.DT_CollateralType6 ,
A.DT_CollateralType7 ,
A.DT_CollateralType8 ,
A.DT_CollateralType9 ,
A.DT_CollateralType10 ,
A.DT_StateCode ,
A.DT_CountyCode ,
A.DT_CountyCode_Description ,
A.SP_ABINumber  ,
A.SP_LocationName ,
A.SP_Address ,
A.SP_City ,
A.SP_State ,
A.SP_Zip ,
A.SP_ZIP4 ,
A.IGE_FullName ,
LTRIM(RTRIM(A.IGE_TitleCode)) IGE_TitleCode,
A.IGE_TitleCode_Back ,
A.IGE_VendorEthnicity ,
A.IGE_ContactID ,
NVL(A.IG_Company,'') IG_Company ,
A.IG_Mailing_Address ,
A.IG_Mailing_City ,
A.IG_Mailing_State ,
A.IG_Mailing_StateCode ,
A.IG_Mailing_Zip ,
A.IG_Mailing_ZipFour ,
A.IG_Mailing_CarrierRouteCode ,
A.IG_Location_Address ,
A.IG_Location_City ,
A.IG_Location_State ,
A.IG_Location_Zip ,
A.IG_Location_ZipFour ,
A.IG_Location_CarrierRouteCode ,
A.IG_CountyCode ,
A.IG_CensusTract ,
A.IG_CensusBlock,
NVL(A.fLATITUDE,'') fLATITUDE ,
NVL(A.fLONGITUDE,'') fLONGITUDE ,
A.IG_MatchCode,
A.IG_PhoneNumber ,
A.IG_FaxPhone ,
A.IG_PrimarySIC6 ,
A.IG_SICCode1 ,
A.IG_SICCode2 ,
A.IG_SICCode3 ,
A.IG_SICCode4 ,
A.IG_NAICSCode ,
NVL(A.IG_EmployeeSizeCode2,'') IG_EmployeeSizeCode2 ,
NVL(A.IG_NumberEmployees,'') IG_NumberEmployees ,
NVL(A.IG_OutputVolumeCode2,'') IG_OutputVolumeCode2 ,
NVL(A.IG_OutputVolume2,'') IG_OutputVolume2 ,
A.IG_SubsidairyABINumber ,
A.IG_ParentABINumber ,
A.IG_BusinessStatusCode,
A.IG_YearFirstAppeared ,
A.IG_CreditAlphaScore ,
A.IG_CreditNumericScore ,
A.IG_CottageCode,
A.IG_OwnOrLease,
A.IG_Squarefootage8,
A.IG_WebAddress ,
A.IG_CallStatusCode,
case when A.Fulfillment_Flag='' then 'U' else A.Fulfillment_Flag end as Fulfillment_Flag,
A.IG_PhoneNumberType ,
A.IG_CBSACode ,
A.IG_CBSALevel ,
A.IG_CSACode ,
A.IG_LegalName ,
A.IG_Mailing_SCF ,
A.IG_Mailing_StateCountyName ,
A.IG_Mailing_StateCity ,
A.IG_Mailing_StateCityZip ,
A.IG_Mailing_StateCountyCode ,
A.IG_Mailing_StateCitySCF ,
A.FirstName  ,
A.LastName  ,
A.Gender,
A.AddressLine1  ,
A.City  ,
A.State  ,
A.Zip  ,
A.DT_Filing_YYYYMM ,
A.DT_statecountycode ,
case when LTRIM(RTRIM(A.DT_FullName))='' then '' else A.DT_FullName end as DT_FullName,
A.MATCHCODE_LRFS  ,
A.Has_IG_Mailing_Address,
A.Has_IGE_ContactName ,
A.Has_IG_WebAddress ,
A.Has_IG_PhoneNumber ,
A.Has_DT_FullName,
A.ListID ,
A.BusinessEmailFlag ,
A.ListType,
A.PermissionType,
A.ProductCode,
A.DT_Address+ A.DT_ZipCode as DT_AddressZip,
A.TitleCode ,
--A.--dd tables columns
NVL(dd1.DT_CorporateIndividual_Description,'') DT_CorporateIndividual_Description,
NVL(dd1.DT_DeliverabilityScore_Description,'') DT_DeliverabilityScore_Description,
NVL(dd1.DT_FilingState_Description,'') DT_FilingState_Description,
NVL(dd1.DT_FilingStatus_Description,'') DT_FilingStatus_Description,
NVL(dd1.DT_FilingTypeCode_Description,'') DT_FilingTypeCode_Description,
NVL(dd1.DT_USPSRecordType_Description,'') DT_USPSRecordType_Description,
NVL(dd1.DT_MatchType_Description,'') DT_MatchType_Description,
NVL(dd1.DT_CollateralType_Description,'') DT_CollateralType_Description,
NVL(dd1.IGE_TitleCode_Description,'') IGE_TitleCode_Description,
NVL(dd1.IG_Mailing_State_Description,'') IG_Mailing_State_Description,
NVL(dd1.IG_MatchCode_Description,'') IG_MatchCode_Description,
NVL(dd1.IG_EmployeeSizeCode2_Description,'') IG_EmployeeSizeCode2_Description,
NVL(dd1.IG_OutputVolumeCode2_Description,'') IG_OutputVolumeCode2_Description,
NVL(dd1.IG_BusinessStatusCode_Description,'') IG_BusinessStatusCode_Description,
NVL(dd1.IG_CottageCode_Description,'') IG_CottageCode_Description,
NVL(dd1.IG_OwnOrLease_Description,'') IG_OwnOrLease_Description,
NVL(dd1.IG_Squarefootage8_Description,'') IG_Squarefootage8_Description,
NVL(dd1.Fulfillment_Flag_Description,'') Fulfillment_Flag_Description,
NVL(dd1.IG_CBSALevel_Description,'') IG_CBSALevel_Description,
NVL(dd2.IGE_VendorEthnicity_Description,'') IGE_VendorEthnicity_Description,
NVL(dd2.IG_CreditAlphaScore_Description,'') IG_CreditAlphaScore_Description,
NVL(dd2.IG_CallStatusCode_Description,'') IG_CallStatusCode_Description,
NVL(dd2.State_Description,'') State_Description,
NVL(d.SIC_Description,'') IG_PrimarySIC6_Description,
NVL(e.SIC_Description,'') IG_SICCode1_Description,
NVL(f.SIC_Description,'') IG_SICCode2_Description,
NVL(g.SIC_Description,'') IG_SICCode3_Description,
NVL(h.SIC_Description,'') IG_SICCode4_Description,
NVL(i.Descriptions,'') IG_NAICSCode_Description,
NVL(j.cDescription,'') IG_CountyCode_Description 

from {tablename3} A 
left join ddvalues_12_dddescriptions dd1 on A.id =dd1.id
left join ddvalues_21_dddescriptions dd2 on A.id =dd2.id
left JOIN SIC_Code_6Digits_Descriptions d on a.IG_PrimarySIC6=d.SIC_Code
left JOIN SIC_Code_6Digits_Descriptions e on a.IG_SICCode1=e.SIC_Code
left JOIN SIC_Code_6Digits_Descriptions f on a.IG_SICCode2=f.SIC_Code
left JOIN SIC_Code_6Digits_Descriptions g on a.IG_SICCode3=g.SIC_Code
left JOIN SIC_Code_6Digits_Descriptions h on a.IG_SICCode4=h.SIC_Code
left JOIN EXCLUDE_NAICS8_Descriptions i on a.IG_NAICSCode=i.NAICS8
left JOIN CountyState_Decode j on a.IG_Mailing_StateCountyCode=j.cCode;