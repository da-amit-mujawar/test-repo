# *Data-Axle Aetna DBid: 1489*

## Pre-processing
The input is generated by [talend@stcdpstalp004l idms-mmdb]$ 
pwd/mnt/idms-mmdb [talend@stcdpstalp004lidms-mmdb]$ which is DataSync'd to S3. 

## Dependencies and Data Axle Sources
The following Redshift source tables shall be  refreshed weekly, yearly, daily, monthly

## Flow of Project:
Aetna team provide us three types of files:
1:) Full_Refresh
2:) Append
3:) Insert_Delete

**Siganl_file naming convention: READY_TABLENAME.dat** 
ex:: READY_TBMZB_MODEL_SCORE.dat
**signalfile folder: mzb_signal**

- **AETNA TEAM: Run DAGs in the following order, We are using two ways to run the day. 1) Lambda 2) Manual Trigger**

**For lambda**
 Lambda dag run time args:
1:) file_key = mzb_signal/signalfilename
2:) bucket_name - aetna bucket
   eg:- **{"file_key":"mzb_signal/READY_TBMZB_MODEL_SCORE.dat","bucket_name":"axle-customer-aetna"}**

*Note : When we run the dag through lambda only one table will process at a time.*

**For manualtrigger**
--file_key - mzb_signal/READY_TBMZB_MODEL_SCORE.dat
--bucket_name - aetna bucket
--tabletype - full_refresh
    eg:- **{"file_key":"mzb_signal/READY_TBMZB_MODEL_SCORE.dat","bucket_name":"axle-customer-aetna","tabletype" : "full_refresh"}**

*Note: manual trigger only supports full_refresh for any table*

- **Child table Views of all tables except who do not contain mzb_indiv_id:** <br/>
1. *child1 - TBMZB_COMM_PROMO_HISTORY* <br/>
2. *child2 - TBMZB_EMAIL_INTERACTIONS* <br/>
3. *child3 - TBMZB_FEDERAL_EMPLOYEES* <br/>
4. *child4 - TBMZB_INDIVIDUAL_DEMOG_IDMS* <br/>
5. *child5 - TBMZB_INDIVIDUAL_EMAIL* <br/>
6. *child6 - TBMZB_INDIV_COMM_PROSPECT_LIST* <br/>
7. *child7 - TBMZB_INDIV_EXPERIAN_LIST* <br/>
8. *child8 - TBMZB_INDIV_INFOGROUP_LIST* <br/>
9. *child9 - TBMZB_INTERACTIONS* <br />
10. *child10 - TBMZB_MEMBERSHIP* <br/> <br/>
11. *child11 - TBMZB_MODEL_SCORES* <br/> <br/>
12. *child12 - TBMZB_SUPPRESSION* <br/>
13. *child13 - TBMZB_B2C_COMM_CONSUMERS* <br/>
14. *child14 - TBMZB_B2C_DA_CONSUMERS* <br/>
15. *child15 - TBMZB_INDIV_ACA_LIST* <br/>
16. *child16 - TBMZB_PROMO_HISTORY_IDMS* <br />

**Important**
We are maintaining bucket level versoning because if our dag fail for any file we can restore previous version of file and we can run our dag again with the previous version of file.









