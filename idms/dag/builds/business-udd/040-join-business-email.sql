INSERT INTO udd_main_table (
        infogroup_id,
        contact_id,
        contact_created_at,
        first_name,
        last_name,
        professional_title,
        gender,
        management_level,
        mapped_contact_id,
        vendor_id,
        job_function_id,
        job_titles_count,
        job_title,
        contact_suppressed_fields_count,
        title_codes_count,
        is_primary,
        email,
        email_md5,
        email_sha256,
        email_vendor_id,
        email_deliverable,
        email_marketable,
        email_reputation_risk,
        --- Places Start Here
        places_created_at,
        places_updated_at,
        local_listings_premium_claimed_at,
        local_listings_claimed_at,
        in_business_determined_at,
        verified_on,
        ownership_changed_on,
        out_of_business_on,
        opened_for_business_on,
        address_changed_on,
        work_at_home,
        suppressed,
        territory,
        public_access,
        medicaid_accepted,
        medicare_accepted,
        cmra_flag,
        mailing_address_cmra_flag,
        hospital_has_emergency_room,
        has_ecommerce,
        foreign_parent_flag,
        equipment_rentals,
        corporate_franchising,
        additional_phone,
        address_type_code,
        alternative_name,
        branch_type_id,
        carrier_route_code,
        cbsa_code,
        cbsa_level,
        census_block,
        census_tract,
        chain_id,
        cik,
        city,
        corporate_employee_count,
        corporate_sales_revenue,
        country_code,
        cross_street_address,
        csa_code,
        delivery_point_bar_code,
        dma_county_rank,
        dma_region,
        dma_territory,
        dress_code,
        duplicate_of,
        estimated_corporate_employee_count,
        estimated_corporate_sales_revenue,
        estimated_location_employee_count,
        facebook_url,
        fax_number,
        fips_code,
        fiscal_year_end_month,
        fortune_ranking,
        foursquare_url,
        geo_match_level,
        headquarters_id,
        in_business,
        in_business_research,
        instagram_url,
        landmark_address,
        latitude,
        linked_in_url,
        location_email_address,
        location_employee_count,
        location_sales_volume,
        logo_url,
        longitude,
        mailing_address,
        mailing_address_carrier_route_code,
        mailing_address_city,
        mailing_address_delivery_point_bar_code,
        mailing_address_postal_code,
        mailing_address_score_code,
        mailing_address_state,
        mailing_address_type_code,
        mailing_address_zip,
        mailing_address_zip_four,
        mailing_score_code,
        name,
        neighborhood,
        operating_hours_description,
        phone,
        phone_call_status_code,
        pinterest_url,
        place_type,
        postal_code,
        price_range,
        primary_naics_code_id,
        primary_sic_code_id,
        segment_id,
        sgc_division,
        square_footage,
        state,
        stock_exchange_code,
        stock_ticker_symbol,
        street,
        suite,
        teleresearch_update_date,
        tumblr_url,
        twitter_url,
        yelp_url,
        youtube_url,
        toll_free_number,
        ultimate_headquarters_id,
        website,
        website_status,
        zip,
        zip_four,
        happy_hours_count,
        historical_names_count,
        images_count,
        insurances_accepted_count,
        languages_spoken_count,
        legal_names_count,
        location_intents_count,
        naics_code_ids_count,
        operating_hours_count,
        payment_types_count,
        preformatted_fields_count,
        record_list_ids_count,
        religious_denomination_ids_count,
        sic_code_ids_count,
        places_suppressed_fields_count,
        tax_ids_count,
        ucc_filings_count,
        website_keywords_count,
        ancestor_headquarters_ids_count,
        affiliation_ids_count,
        bankruptcies_count,
        benefit_plans_count,
        branch_count,
        brand_ids_count,
        business_type_ids_count,
        car_make_ids_count,
        contacts_count
    )
SELECT a.infogroup_id,
    a.id,
    a.contact_created_at,
    a.first_name,
    a.last_name,
    a.professional_title,
    a.gender,
    a.management_level,
    a.mapped_contact_id,
    a.vendor_id,
    a.job_function_id,
    a.job_titles_count,
    a.job_title,
    a.contact_suppressed_fields_count,
    a.title_codes_count,
    a.is_primary,
    b.email,
    b.email_md5,
    b.email_sha256,
    b.email_vendor_id,
    b.email_deliverable,
    b.email_marketable,
    b.email_reputation_risk,
    a.places_created_at,
    a.places_updated_at,
    a.local_listings_premium_claimed_at,
    a.local_listings_claimed_at,
    a.in_business_determined_at,
    a.verified_on,
    a.ownership_changed_on,
    a.out_of_business_on,
    a.opened_for_business_on,
    a.address_changed_on,
    a.work_at_home,
    a.suppressed,
    a.territory,
    a.public_access,
    a.medicaid_accepted,
    a.medicare_accepted,
    a.cmra_flag,
    a.mailing_address_cmra_flag,
    a.hospital_has_emergency_room,
    a.has_ecommerce,
    a.foreign_parent_flag,
    a.equipment_rentals,
    a.corporate_franchising,
    a.additional_phone,
    a.address_type_code,
    a.alternative_name,
    a.branch_type_id,
    a.carrier_route_code,
    a.cbsa_code,
    a.cbsa_level,
    a.census_block,
    a.census_tract,
    a.chain_id,
    a.cik,
    a.city,
    a.corporate_employee_count,
    a.corporate_sales_revenue,
    a.country_code,
    a.cross_street_address,
    a.csa_code,
    a.delivery_point_bar_code,
    a.dma_county_rank,
    a.dma_region,
    a.dma_territory,
    a.dress_code,
    a.duplicate_of,
    a.estimated_corporate_employee_count,
    a.estimated_corporate_sales_revenue,
    a.estimated_location_employee_count,
    a.facebook_url,
    a.fax_number,
    a.fips_code,
    a.fiscal_year_end_month,
    a.fortune_ranking,
    a.foursquare_url,
    a.geo_match_level,
    a.headquarters_id,
    a.in_business,
    a.in_business_research,
    a.instagram_url,
    a.landmark_address,
    a.latitude,
    a.linked_in_url,
    a.location_email_address,
    a.location_employee_count,
    a.location_sales_volume,
    a.logo_url,
    a.longitude,
    a.mailing_address,
    a.mailing_address_carrier_route_code,
    a.mailing_address_city,
    a.mailing_address_delivery_point_bar_code,
    a.mailing_address_postal_code,
    a.mailing_address_score_code,
    a.mailing_address_state,
    a.mailing_address_type_code,
    a.mailing_address_zip,
    a.mailing_address_zip_four,
    a.mailing_score_code,
    a.name,
    a.neighborhood,
    a.operating_hours_description,
    a.phone,
    a.phone_call_status_code,
    a.pinterest_url,
    a.place_type,
    a.postal_code,
    a.price_range,
    a.primary_naics_code_id,
    a.primary_sic_code_id,
    a.segment_id,
    a.sgc_division,
    a.square_footage,
    a.state,
    a.stock_exchange_code,
    a.stock_ticker_symbol,
    a.street,
    a.suite,
    a.teleresearch_update_date,
    a.tumblr_url,
    a.twitter_url,
    a.yelp_url,
    a.youtube_url,
    a.toll_free_number,
    a.ultimate_headquarters_id,
    a.website,
    a.website_status,
    a.zip,
    a.zip_four,
    a.happy_hours_count,
    a.historical_names_count,
    a.images_count,
    a.insurances_accepted_count,
    a.languages_spoken_count,
    a.legal_names_count,
    a.location_intents_count,
    a.naics_code_ids_count,
    a.operating_hours_count,
    a.payment_types_count,
    a.preformatted_fields_count,
    a.record_list_ids_count,
    a.religious_denomination_ids_count,
    a.sic_code_ids_count,
    a.places_suppressed_fields_count,
    a.tax_ids_count,
    a.ucc_filings_count,
    a.website_keywords_count,
    a.ancestor_headquarters_ids_count,
    a.affiliation_ids_count,
    a.bankruptcies_count,
    a.benefit_plans_count,
    a.branch_count,
    a.brand_ids_count,
    a.business_type_ids_count,
    a.car_make_ids_count,
    a.contacts_count
 FROM udd_main_table a
INNER JOIN (SELECT ABI_Number_LRFS, ContactID, Email_Address_LRFS email, CASE MAX(Email_Deliverable) WHEN 'T' THEN 1 ELSE 0 END Email_Deliverable, 
                   CASE MAX(email_marketable) WHEN 'T' THEN 1 ELSE 0 END email_marketable, MAX(md5lower_LRFS) email_md5,
                   MAX(email_reputation_risk) email_reputation_risk, 
                   MAX(SHA256Lower) email_sha256, MAX(Vendor_ID_LRFS) email_vendor_id 
              FROM {business-email-table} 
             WHERE Email_Address_LRFS NOT IN (SELECT UPPER(email) 
                                                FROM udd_main_table 
                                               GROUP BY email)
             GROUP BY ABI_Number_LRFS, ContactID, Email_Address_LRFS 
           ) b 
   ON a.infogroup_id = b.ABI_Number_LRFS AND a.mapped_contact_id = b.ContactID;
  ;
 