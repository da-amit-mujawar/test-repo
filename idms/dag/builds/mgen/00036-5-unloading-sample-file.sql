unload('
select
rtrim(tblmain.matchcode),
rtrim(tblmain.id),
rtrim(tblmain.cid),
rtrim(tblmain.firstname),
rtrim(tblmain.lastname),
rtrim(tblmain.fin_gen),
rtrim(tblmain.fin_age),
rtrim(tblmain.fin_indid),
rtrim(tblmain.fin_hhld),
rtrim(tblmain.file_source),
rtrim(tblmain.addressline1),
rtrim(tblmain.addressline2),
rtrim(tblmain.city),
rtrim(tblmain.st),
rtrim(tblmain.zip),
rtrim(tblmain.zip4),
rtrim(tblmain.scf),
rtrim(tblmain.fin_dob),
rtrim(tblmain.fin_ethcode),
rtrim(tblmain.fin_ethgroup),
rtrim(tblmain.fin_language),
rtrim(tblmain.fin_relcode),
rtrim(tblmain.fin_married),
rtrim(tblmain.fin_politic),
rtrim(tblmain.lems),
rtrim(tblmain.age_code),
rtrim(tblmain.combined_age),
rtrim(tblmain.dqi_match_flag),
rtrim(tblmain.smb_flag),
rtrim(tblmain.sic_2),
rtrim(tblmain.cd_rating_2014),
rtrim(tblmain.consumer_digital_match), --added by niken as per elinas request on 08/30/2017
rtrim(tblmain.edb_match_flag), --added by naimeel as per elinas request on 03/02/2018 #664665
rtrim(tblmain.pub2_moslo),
rtrim(tblmain.pub2_total_mag),
rtrim(tblmain.pub2_total_pub_books),
rtrim(tblmain.pub2_mag_moslo),
rtrim(tblmain.pub2_mag_totord),
rtrim(tblmain.pub2_active_mag),
rtrim(tblmain.pub2_total_cat_books),
rtrim(tblmain.pub2_mag_autornwl),
rtrim(tblmain.pub2_expire_mag),
rtrim(tblmain.pub2_mag_paid),
rtrim(tblmain.pub2_mag_paid_cash),
rtrim(tblmain.publisher2_source_arr),
rtrim(tblmain.publisher2_cat1_arr),
rtrim(tblmain.publisher2_cat2_arr),--added by naimeel as per elinas request on 03/02/2018 #664665
rtrim(tblchild1.last_transaction_overall),
rtrim(tblchild1.last_transaction_catalog),
rtrim(tblchild1.last_transaction_web),
rtrim(tblchild1.last_transaction_retail),
rtrim(tblchild1.last_transaction_overall_days),
rtrim(tblchild1.last_transaction_catalog_days),
rtrim(tblchild1.last_transaction_web_days),
rtrim(tblchild1.last_transaction_retail_days),
rtrim(tblchild1.tot_parts),
rtrim(tblchild1.cat_parts),
rtrim(tblchild1.web_parts),
rtrim(tblchild1.rtl_parts),
rtrim(tblchild1.tot_dlrs_12m),
rtrim(tblchild1.tot_trns_12m),
rtrim(tblchild1.tot_dlrs_13p),
rtrim(tblchild1.tot_trns_13p),
rtrim(tblchild1.tot_dlrs_24p),
rtrim(tblchild1.tot_trns_24p),
rtrim(tblchild1.cat_dlrs_12m),
rtrim(tblchild1.cat_trns_12m),
rtrim(tblchild1.cat_dlrs_13p),
rtrim(tblchild1.cat_trns_13p),
rtrim(tblchild1.cat_dlrs_24p),
rtrim(tblchild1.cat_trns_24p),
rtrim(tblchild1.web_dlrs_12m),
rtrim(tblchild1.web_trns_12m),
rtrim(tblchild1.web_dlrs_13p),
rtrim(tblchild1.web_trns_13p),
rtrim(tblchild1.web_dlrs_24p),
rtrim(tblchild1.web_trns_24p),
rtrim(tblchild1.rtl_dlrs_12m),
rtrim(tblchild1.rtl_trns_12m),
rtrim(tblchild1.rtl_dlrs_13p),
rtrim(tblchild1.rtl_trns_13p),
rtrim(tblchild1.rtl_dlrs_24p),
rtrim(tblchild1.rtl_trns_24p),
rtrim(tblchild1.tot_dlrs_12m_avg),
rtrim(tblchild1.tot_dlrs_13p_avg),
rtrim(tblchild1.tot_dlrs_24p_avg),
rtrim(tblchild1.cat_dlrs_12m_avg),
rtrim(tblchild1.cat_dlrs_13p_avg),
rtrim(tblchild1.cat_dlrs_24p_avg),
rtrim(tblchild1.web_dlrs_12m_avg),
rtrim(tblchild1.web_dlrs_13p_avg),
rtrim(tblchild1.web_dlrs_24p_avg),
rtrim(tblchild1.rtl_dlrs_12m_avg),
rtrim(tblchild1.rtl_dlrs_13p_avg),
rtrim(tblchild1.rtl_dlrs_24p_avg),
rtrim(tblchild1.pay_12m_db),
rtrim(tblchild1.pay_12m_cc),
rtrim(tblchild1.pay_12m_dc),
rtrim(tblchild1.pay_12m_pc),
rtrim(tblchild1.pay_12m_cash),
rtrim(tblchild1.pay_12m_oth),
rtrim(tblchild1.pay_12m_ukn),
rtrim(tblchild1.pay_13p_db),
rtrim(tblchild1.pay_13p_cc),
rtrim(tblchild1.pay_13p_dc),
rtrim(tblchild1.pay_13p_pc),
rtrim(tblchild1.pay_13p_cash),
rtrim(tblchild1.pay_13p_oth),
rtrim(tblchild1.pay_13p_ukn),
rtrim(tblchild1.cctype_12m_visa),
rtrim(tblchild1.cctype_12m_mc),
rtrim(tblchild1.cctype_12m_amex),
rtrim(tblchild1.cctype_12m_disc),
rtrim(tblchild1.cctype_12m_btq),
rtrim(tblchild1.cctype_12m_oth),
rtrim(tblchild1.cctype_12m_ukn),
rtrim(tblchild1.cctype_13p_visa),
rtrim(tblchild1.cctype_13p_mc),
rtrim(tblchild1.cctype_13p_amex),
rtrim(tblchild1.cctype_13p_disc),
rtrim(tblchild1.cctype_13p_btq),
rtrim(tblchild1.cctype_13p_oth),
rtrim(tblchild1.cctype_13p_ukn),
rtrim(tblchild2.child1_dob),
rtrim(tblchild2.child1_gender),
rtrim(tblchild2.child2_dob),
rtrim(tblchild2.child2_gender),
rtrim(tblchild2.child3_dob),
rtrim(tblchild2.child3_gender),
rtrim(tblchild2.child4_dob),
rtrim(tblchild2.child4_gender),
rtrim(tblchild2.child5_dob),
rtrim(tblchild2.child5_gender),
rtrim(tblchild2.locationtype),
rtrim(tblchild2.emailpresenceflag),
rtrim(tblchild2.grandparentinhouse),
rtrim(tblchild2.homeequityestimate),
rtrim(tblchild2.income_code),
rtrim(tblchild2.homevalue),
rtrim(tblchild2.findincome),
rtrim(tblchild2.lengthofresidence),
rtrim(tblchild2.length_of_residence_code),
rtrim(tblchild2.wealthfinder),
rtrim(tblchild2.nielsencountyrank),
rtrim(tblchild2.numberofadults),
rtrim(tblchild2.numberofchildren),
rtrim(tblchild2.femaleoccupation),
rtrim(tblchild2.maleoccupation),
rtrim(tblchild2.ownrent),
rtrim(tblchild2.potentialinvestorconsumer),
rtrim(tblchild2.presenceofchildren),
rtrim(tblchild2.phone1),
rtrim(tblchild2.phonenumbertype),
rtrim(tblchild2.workathomeflag),
rtrim(tblchild2.internetusage),
rtrim(tblchild2.heavy_internet_user),
rtrim(tblchild2.dmhightechhousehold),
rtrim(tblchild2.hohagecode),
rtrim(tblchild2.ppi),
rtrim(tblchild2.ppi_code),
rtrim(tblchild2.congressionaldistrict),
rtrim(tblchild2.consumer_stability_index_raw_score),
rtrim(tblchild2.delivery_unit_size),
rtrim(tblchild2.expendable_income_rank_code),
rtrim(tblchild2.mail_order_buyer_current_flag),
rtrim(tblchild2.mail_order_buyer_ever_flag),
rtrim(tblchild2.mail_order_software_purchase_flag),
rtrim(tblchild2.veteraninhhld),
rtrim(tblchild2.home_age),
rtrim(tblchild2.home_sale_date),
rtrim(tblchild2.revolver_to_transactor_model),
rtrim(tblchild3.experian_income),
rtrim(tblchild3.experian_enhanced_income),
rtrim(tblchild3.experian_person1_dob),
rtrim(tblchild3.experian_estimated_age),
rtrim(tblchild3.experian_exact_age),
rtrim(tblchild3.experian_presence_of_children_type),
rtrim(tblchild3.experian_presence_of_children_code),
rtrim(tblchild3.experian_ethnic_ethnic),
rtrim(tblchild3.experian_ethnic_experian_group),
rtrim(tblchild3.experian_ethnic_religion),
rtrim(tblchild3.experian_ethnic_language_preference),
rtrim(tblchild3.experian_ethnic_group),
rtrim(tblchild3.experian_ethnic_country_of_origin),
rtrim(tblchild3.experian_presence_of_child_0_18),
rtrim(tblchild3.experian_donor_any),
rtrim(tblchild3.experian_child_any),
rtrim(ailments_flags),
rtrim(children_age_presence_flag),
rtrim(credit_card_flag),
rtrim(dlx_segments),
rtrim(donor_flags),
rtrim(experian_child_array),
rtrim(experian_donor_array),
rtrim(experian_lifestyle_array),
rtrim(interest_flag),
rtrim(lifestyle_hobby_interest_flags),
rtrim(market_target_age_flags),
rtrim(arr_twm),
rtrim(tblmain.infopersona_cluster),
rtrim(tblmain.infopersona_supercluster),
rtrim( tblmain.state_code),
rtrim(tblmain.county_code),
rtrim(tblmain.ce_income_producing_assets),
rtrim(tblmain.ce_discretionary_income_score),
rtrim(tblmain.ce_pensioner_present_flag),
rtrim(tblmain.winmargin),
rtrim(tblmain.educational_model),
rtrim(tblmain.buy_segment), --added by naimeel as per elinas request on 05/03/2018 #680571
rtrim(tblmain.buy_score), --added by naimeel as per elinas request on 05/03/2018 #680571
rtrim(tblmain.execureach_match_flag), --added by reeba as per elinas request on 06/28/2018 #694596
rtrim(tblmain.exec_bus_igid), --added 37 exec_ fields below by sf on 06/07/2019 tkt 782085
rtrim(tblmain.exec_bus_titlecode),
rtrim(tblmain.exec_bus_titlecodedescription),
rtrim(tblmain.exec_bus_employeesizecode),
rtrim(tblmain.exec_bus_locationoutputvolumecode),
rtrim(tblmain.exec_bus_primarysiccode_6digit),
rtrim(tblmain.exec_cons_locationtype),
rtrim(tblmain.exec_bus_fulfillment_flag),
rtrim(tblmain.exec_bus_cbsa),
rtrim(tblmain.exec_bus_cbsalevel),
rtrim(tblmain.exec_bus_companyholdingstatus),
rtrim(tblmain.exec_bus_cottagecode),
rtrim(tblmain.exec_bus_mailscore),
rtrim(tblmain.exec_execureach_type),
rtrim(tblmain.exec_execureach_quality),
rtrim(tblmain.exec_bus_actual_location_employeesize),
rtrim(tblmain.exec_bus_corporate_employeesizecode),
rtrim(tblmain.exec_bus_actual_location_outputvolume),
rtrim(tblmain.exec_bus_corporateoutputvolumecode),
rtrim(tblmain.exec_bus_square_footage),
rtrim(tblmain.exec_bus_credit_alphascore),
rtrim(tblmain.exec_bus_rolecode),
rtrim(tblmain.exec_bus_digitalflag),
rtrim(tblmain.exec_bus_businessstatuscode),
rtrim(tblmain.exec_bus_departmentcode),
rtrim(tblmain.exec_bus_levelcode),
rtrim(tblmain.exec_bus_royalty_record),
rtrim(tblmain.exec_bus_email_md5_lower),
rtrim(tblmain.exec_bus_email_md5_upper),
rtrim(tblmain.exec_bus_contactliteraltitlecode),
rtrim(tblmain.exec_bus_contactliteraltitlecode_description),
rtrim(tblmain.exec_bus_contactid),
rtrim(tblmain.exec_bus_professionaltitle),
rtrim(tblmain.exec_bus_companyname_available),
rtrim(tblmain.exec_bus_sic2),
rtrim(tblmain.exec_bus_sic4),
rtrim(tblmain.exec_bus_igid_available),
rtrim(tblmain.haystaq_array), -- added by sf 12.12.2019 per elinas request on ticket #825596
rtrim(tblmain.dma_code),      -- added by rj 01.13.2020 per elinas request on ticket  #829689
rtrim(tblmain.lot_size)       -- added by rj 08.30.2020 per elinas request on ticket  #886424

from onepercent_modelsample_{build_id} sample
inner join tblmain_{build_id}_{build} tblmain
on sample.id = tblmain.id
left join tblchild1_{build_id}_{build} tblchild1
on tblmain.cid = tblchild1.cid
left join tblchild2_{build_id}_{build} tblchild2
on tblmain.cid = tblchild2.cid
left join tblchild3_{build_id}_{build} tblchild3
on tblmain.cid = tblchild3.cid
')
to 's3://{s3-internal}/neptune/mGen/ModelSample/build_{build}/mgen-1p/mgenidmssample_main'
iam_role '{iam}'
kms_key_id '{kmskey}'
encrypted
parallel off
CSV DELIMITER AS '|'
allowoverwrite
gzip;